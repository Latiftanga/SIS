{% extends "dashboard/layouts/dashboard_base.html" %}
{% load static %}

{% block title %}{{ action }} Class{% endblock %}

{% block content %}
<div class="p-6">
    <!-- Breadcrumb -->
    <div class="text-sm breadcrumbs mb-4">
        <ul>
            <li>
                <a href="{% url 'classes:class_list' %}"
                   hx-get="{% url 'classes:class_list' %}"
                   hx-target="#main-content"
                   hx-push-url="true">Classes</a>
            </li>
            {% if class %}
                <li>
                    <a href="{% url 'classes:class_detail' class.pk %}"
                       hx-get="{% url 'classes:class_detail' class.pk %}"
                       hx-target="#main-content"
                       hx-push-url="true">{{ class.name }}</a>
                </li>
                <li>{{ action }}</li>
            {% else %}
                <li>{{ action }}</li>
            {% endif %}
        </ul>
    </div>

    <!-- Header -->
    <div class="mb-6">
        <h1 class="text-3xl font-bold">{{ action }} Class</h1>
        <p class="text-gray-600 mt-1">Fill in the details below to {{ action|lower }} a class</p>
    </div>

    <!-- Form -->
    <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
            <form method="post"
                  hx-post="{% if class %}{% url 'classes:class_edit' class.pk %}{% else %}{% url 'classes:class_create' %}{% endif %}"
                  hx-target="#main-content"
                  hx-swap="innerHTML">
                {% csrf_token %}

                <!-- Display form errors -->
                {% if form.non_field_errors %}
                    <div class="alert alert-error mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current flex-shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        <div>
                            {% for error in form.non_field_errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}

                <div class="alert alert-info text-sm mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span>Class name will be auto-generated (e.g., "Basic 1 A", "Basic 7 B", "SHS 2 Science A")</span>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <!-- Grade Level -->
                    <div class="form-control w-full">
                        <label class="label">
                            <span class="label-text font-semibold">Grade Level <span class="text-error">*</span></span>
                        </label>
                        {{ form.grade_level }}
                        {% if form.grade_level.errors %}
                            <label class="label">
                                <span class="label-text-alt text-error">{{ form.grade_level.errors.0 }}</span>
                            </label>
                        {% endif %}
                    </div>

                    <!-- Section -->
                    <div class="form-control w-full">
                        <label class="label">
                            <span class="label-text font-semibold">Section</span>
                        </label>
                        {{ form.section }}
                        {% if form.section.errors %}
                            <label class="label">
                                <span class="label-text-alt text-error">{{ form.section.errors.0 }}</span>
                            </label>
                        {% else %}
                            <label class="label">
                                <span class="label-text-alt">Optional: A, B, C, Science, Arts, etc.</span>
                            </label>
                        {% endif %}
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <!-- Programme -->
                    <div class="form-control w-full">
                        <label class="label">
                            <span class="label-text font-semibold">Programme</span>
                        </label>
                        {{ form.programme }}
                        {% if form.programme.errors %}
                            <label class="label">
                                <span class="label-text-alt text-error">{{ form.programme.errors.0 }}</span>
                            </label>
                        {% else %}
                            <label class="label">
                                <span class="label-text-alt">For SHS only (e.g., Science, Business, Arts)</span>
                            </label>
                        {% endif %}
                    </div>

                    <!-- Class Teacher -->
                    <div class="form-control w-full">
                        <label class="label">
                            <span class="label-text font-semibold">Class Teacher</span>
                        </label>
                        {{ form.class_teacher }}
                        {% if form.class_teacher.errors %}
                            <label class="label">
                                <span class="label-text-alt text-error">{{ form.class_teacher.errors.0 }}</span>
                            </label>
                        {% endif %}
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <!-- Capacity -->
                    <div class="form-control w-full">
                        <label class="label">
                            <span class="label-text font-semibold">Capacity <span class="text-error">*</span></span>
                        </label>
                        {{ form.capacity }}
                        {% if form.capacity.errors %}
                            <label class="label">
                                <span class="label-text-alt text-error">{{ form.capacity.errors.0 }}</span>
                            </label>
                        {% endif %}
                    </div>

                    <!-- Room Number -->
                    <div class="form-control w-full">
                        <label class="label">
                            <span class="label-text font-semibold">Room Number</span>
                        </label>
                        {{ form.room_number }}
                        {% if form.room_number.errors %}
                            <label class="label">
                                <span class="label-text-alt text-error">{{ form.room_number.errors.0 }}</span>
                            </label>
                        {% endif %}
                    </div>
                </div>

                <!-- Academic Year -->
                <div class="form-control w-full mb-4">
                    <label class="label">
                        <span class="label-text font-semibold">Academic Year <span class="text-error">*</span></span>
                    </label>
                    {{ form.academic_year }}
                    {% if form.academic_year.errors %}
                        <label class="label">
                            <span class="label-text-alt text-error">{{ form.academic_year.errors.0 }}</span>
                        </label>
                    {% endif %}
                </div>

                <!-- Active Status -->
                <div class="form-control mb-4">
                    <label class="label cursor-pointer justify-start">
                        {{ form.is_active }}
                        <span class="label-text ml-2">Active</span>
                    </label>
                    {% if form.is_active.errors %}
                        <label class="label">
                            <span class="label-text-alt text-error">{{ form.is_active.errors.0 }}</span>
                        </label>
                    {% endif %}
                </div>

                <!-- Actions -->
                <div class="card-actions justify-end mt-6">
                    <a href="{% url 'classes:class_list' %}"
                       hx-get="{% url 'classes:class_list' %}"
                       hx-target="#main-content"
                       hx-push-url="true"
                       class="btn btn-ghost">Cancel</a>
                    <button type="submit" class="btn btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        {{ action }} Class
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
